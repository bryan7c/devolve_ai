import { useState, useEffect } from "react";
import Head from "next/head";
import { InternalLayout } from "@/layout/internalLayout";
import { Grid, MenuItem } from "@mui/material";
import CardReturnedItem from "@/components/CardReturnedItem/CardReturnedItem";
import ActionMenu from "@/components/ActionMenu/ActionMenu";
import { deleteReturnedItem, getReturnedItems } from "@/services/ReturnedService";

function ReturnedPage() {
  const [returnedList, setReturnedList] = useState([]);

  useEffect(() => {
    async function fetchReturned() {
      getReturnedItems()
      .then((data) => {
        setReturnedList(data);
      })
    }

    fetchReturned();
  }, []);

  const handleEdit = (returnedItemId) => {
    alert(`Editando devolução ${returnedItemId}`);
  };

  const handleDelete = (returnedItemId) => {
    alert(`Deletando devolução ${returnedItemId}`);
    // deleteReturnedItem(returnedItemId)
    // .then(() => {
    //   setReturnedList(returnedList.filter(returnedItem => returnedItem._id !== returnedItemId));
    // });
  };

  return (
    <>
      <Head>
        <title>Devolução</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Grid container spacing={2}>
        {returnedList.map((returnedItem) => (
          <CardReturnedItem
            key={returnedItem._id}
            returnedItem={returnedItem}
            action={
              <ActionMenu>
                <MenuItem onClick={() => handleEdit(returnedItem._id)}>
                  Editar
                </MenuItem>
                <MenuItem onClick={() => handleDelete(returnedItem._id)}>
                  Excluir
                </MenuItem>
              </ActionMenu>
            }
          />
        ))}
      </Grid>
    </>
  );
}
ReturnedPage.PageLayout = InternalLayout;

export default ReturnedPage;
