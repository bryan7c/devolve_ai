import { useState, useEffect } from "react";
import Head from "next/head";
import { InternalLayout } from "@/src/layout/internalLayout";
import { useRouter } from "next/router";
import { getReturnedItems } from "@/src/services/ReturnedService";
import {
  Button,
  Grid,
  IconButton,
  InputBase,
  Paper,
  Typography,
} from "@mui/material";
import { Search } from "@mui/icons-material";
import { DatePicker, LocalizationProvider } from "@mui/x-date-pickers";
import { AdapterDayjs } from "@mui/x-date-pickers/AdapterDayjs";
import dayjs from "dayjs";
import 'dayjs/locale/pt-br';
import { formatDate } from "@/src/utils/date";

function ReturnedPage() {
  const router = useRouter();
  const { id } = router.query;
  const [returnedItem, setReturnedItem] = useState(null);
  const [searchValue, setSearchValue] = useState("");
  const [returnedItemDate, setReturnedItemDate] = useState(dayjs(new Date()));

  const handleSearchChange = (event) => {
    setSearchValue(event.target.value);
  };

  useEffect(() => {
    async function fetchReturned(returnedItem) {
      getReturnedItems(returnedItem).then((data) => {
        setReturnedItem(data[0]);
      });
    }
    fetchReturned({ id });
  }, []);

  return (
    <>
      <Head>
        <title>Editando devolução</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Paper
        component="form"
        elevation={3}
        sx={{
          p: "2px 4px",
          display: "flex",
          alignItems: "center",
          marginBottom: 2,
        }}
      >
        <Grid container spacing={2} sx={{ flex: 1 }}>
          <Grid item xs={12} direction={"column"}>
            <IconButton type="button" sx={{ p: "10px" }} aria-label="search">
              <Search />
            </IconButton>
            <InputBase
              sx={{ ml: 1, flex: 1 }}
              placeholder="Pesquisar devolução"
              value={searchValue}
              onChange={handleSearchChange}
            />
          </Grid>
          <Grid item xs={12} direction={"column"}>
            <Grid container spacing={2}>
              <Grid item xs={3}>
                <Grid container>
                  <Grid item xs={12} direction={"column"}>
                    <Typography variant="h4">Lista de result</Typography>
                  </Grid>
                  <Grid item xs={12} direction={"column"}>
                    <LocalizationProvider dateAdapter={AdapterDayjs} adapterLocale="pt-br">
                      <DatePicker
                        label="Data limite"
                        onChange={(newDate) => handleDateFilter(newDate)}
                        value={returnedItemDate}
                      />
                    </LocalizationProvider>
                  </Grid>
                  <Grid item xs={12} direction={"column"}>
                    <Button
                      xs={12}
                      variant="contained"
                      size="large"
                      color="info"
                    >
                      CRIAR DEVOLUÇAO
                    </Button>
                  </Grid>
                </Grid>
              </Grid>
              <Grid item xs={9}>
                <Typography variant="h4">Mapa</Typography>
              </Grid>
            </Grid>
          </Grid>
        </Grid>
      </Paper>
      {JSON.stringify(returnedItem)}
    </>
  );
}
ReturnedPage.PageLayout = InternalLayout;

export default ReturnedPage;
